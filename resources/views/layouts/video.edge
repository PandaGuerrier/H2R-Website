<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link href="https://unpkg.com/video.js@7/dist/video-js.min.css" rel="stylesheet"/>
    <title>Video â€¢ {{ title }}</title>
    @entryPointStyles('app')
    @entryPointScripts('app')
</head>

<body class="h-full w-full bg-sky-800">
    <main class="h-full w-full bg-sky-800">
        @component('components/navbar')
          
        @end
        <div class="flex justify-center mt-32">
            <div class="flex flex-col items-start mb-10 space-y-2">
                <h1 id="title" class="text-4xl font-bold text-white">Titre: {{ title }}</h1>
            <div class="mt-3 text-center sm:mt-0 sm:text-left">
              <div class="mt-2">
                <p class="text-xl text-white">Description: {{ description }}</p>
              </div>
            </div>
            @!section('video')
          </div>
        </div>

        <div class="w-full">
            <div class="flex justify-center">
                 <div class="w-1/2 flex justify-center items-center space-x-3 mr-32">
                    @if(author.avatar)
                     <img src="{{ author.avatar }}" alt="avatar" class="w-10 h-10 rounded-full">
                    @else
                      <img src="https://ui-avatars.com/api/?name={{ author.username }}" alt="avatar" class="w-5 h-5 rounded-full md:w-10 md:h-10">
                    @endif
                    <h2 class="text-white text-sm md:text-lg">{{ author.username }}</h2>
                 </div>
                <div class="flex justify-center w-1/2">
                    <div class="flex flex-col items-center mt-4">
                        @if(video.likes.includes(auth.user.id))
                            <button id="like" class="text-white text-2xl animate-bounce" onclick="like()">
                                <svg width="23" height="21" viewBox="0 0 23 21" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M20.2913 2.61183C19.7805 2.10083 19.1741 1.69547 18.5066 1.41891C17.8392 1.14235 17.1238 1 16.4013 1C15.6788 1 14.9634 1.14235 14.2959 1.41891C13.6285 1.69547 13.022 2.10083 12.5113 2.61183L11.4513 3.67183L10.3913 2.61183C9.3596 1.58013 7.96032 1.00053 6.50129 1.00053C5.04226 1.00053 3.64298 1.58013 2.61129 2.61183C1.5796 3.64352 1 5.04279 1 6.50183C1 7.96086 1.5796 9.36013 2.61129 10.3918L3.67129 11.4518L11.4513 19.2318L19.2313 11.4518L20.2913 10.3918C20.8023 9.88107 21.2076 9.27464 21.4842 8.60718C21.7608 7.93972 21.9031 7.22431 21.9031 6.50183C21.9031 5.77934 21.7608 5.06393 21.4842 4.39647C21.2076 3.72901 20.8023 3.12258 20.2913 2.61183Z"
                                        fill="#E56363" stroke="#E66363" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" />
                                </svg>
                            </button>
                        @else
                            <button id="like" class="text-white text-2xl" onclick="like()">
                                <svg width="23" height="21" viewBox="0 0 23 21" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M20.2913 2.61183C19.7805 2.10083 19.1741 1.69547 18.5066 1.41891C17.8392 1.14235 17.1238 1 16.4013 1C15.6788 1 14.9634 1.14235 14.2959 1.41891C13.6285 1.69547 13.022 2.10083 12.5113 2.61183L11.4513 3.67183L10.3913 2.61183C9.3596 1.58013 7.96032 1.00053 6.50129 1.00053C5.04226 1.00053 3.64298 1.58013 2.61129 2.61183C1.5796 3.64352 1 5.04279 1 6.50183C1 7.96086 1.5796 9.36013 2.61129 10.3918L3.67129 11.4518L11.4513 19.2318L19.2313 11.4518L20.2913 10.3918C20.8023 9.88107 21.2076 9.27464 21.4842 8.60718C21.7608 7.93972 21.9031 7.22431 21.9031 6.50183C21.9031 5.77934 21.7608 5.06393 21.4842 4.39647C21.2076 3.72901 20.8023 3.12258 20.2913 2.61183V2.61183Z"
                                        stroke="#AFAFAF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                            </button>
                        @endif
                        <p id="likeLength" class="text-white">{{ JSON.parse(video.likes).length }}</p>
                    </div>
    
                    <div class="flex flex-col items-center mt-4 ml-4 text-white">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M8.625 9.75a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375m-13.5 3.01c0 1.6 1.123 2.994 2.707 3.227 1.087.16 2.185.283 3.293.369V21l4.184-4.183a1.14 1.14 0 01.778-.332 48.294 48.294 0 005.83-.498c1.585-.233 2.708-1.626 2.708-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0012 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018z" />
                        </svg>
                        
                        <p class="text-white">{{ JSON.parse(video.comments).length }}</p>
                    </div>
                </div>
            </div>
        </div>
        
        
        <div class="w-full flex justify-center items-centers">
            <div class="ml-32 w-2/3 flex justify-start">
                <div class="flex flex-col justify-start items-start w-1/2 mt-14 mb-9">
                    <form action={{ route('videos.comment', [video.id] )}} method="POST" class="mb-5">
                        <div class="relative">
                            <label for="about" class="block text-md font-medium text-white">Commenter</label>
                            <div class="flex flex-col mt-1">
                            <textarea id="text" name="text" rows="3" class="mt-1 block rounded-md w-52 md:w-96 border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" placeholder="Votre commentaire.."></textarea>
                            <button type="submit" class="mt-5 h-10 bg-sky-900 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-sky-600 duration-200">Commenter</button>
                            </div>
                            @if(flashMessages.get('error'))
                            <span class="block sm:inline text-sm text-red-400">{{ flashMessages.get('error') }}</span>
                            @endif
                        </div>
                    </form>
                    @each(comment in comments) 
                        <div class="p-6 min-w-full bg-sky-900 rounded-lg shadow-md mb-5">
                            <div class="flex items-center rounded-md pb-5">
                                @if(comment.user.avatar)
                                    <img src="{{ comment.user.avatar }}" alt="avatar" class="w-10 h-10 rounded-full">
                                @else
                                    <img src="https://ui-avatars.com/api/?name={{ comment.user.username }}" alt="avatar" class="w-5 h-5 rounded-full md:w-10 md:h-10">
                                @endif
                                
                                <h2 class="text-white p-2 text-sm md:text-lg">{{ comment.user.username }}</h2>
                            </div>
                            <p class="mb-3 font-normal text-white dark:text-gray-400">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa{{ comment.text }}</p>
    
                            @can('video:deleteComment', comment)
                                <form action={{ route('comment.delete', [video.id, comment.id] )}} method="POST">
                                    <button type="submit" class="text-white bg-red-400 hover:bg-red-500 duration-200 p-2 rounded-md">
                                        Supprimer
                                    </button>
                                </form>
                            @end
                        </div>
                    @endeach
        </div>
      </div>
    </div>
    </main>
</body>

<script src="https://vjs.zencdn.net/7.17.0/video.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
<script>
    // like
    function like() {
        fetch('/video/like/{{ video.id }}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                user: '{{ auth.user.id }}'
            })
        }).then(res => res.json()).then(data => {
            if (data.isLiked) {

                      document.getElementById('like').innerHTML = `<svg width="23" height="21" viewBox="0 0 23 21" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20.2913 2.61183C19.7805 2.10083 19.1741 1.69547 18.5066 1.41891C17.8392 1.14235 17.1238 1 16.4013 1C15.6788 1 14.9634 1.14235 14.2959 1.41891C13.6285 1.69547 13.022 2.10083 12.5113 2.61183L11.4513 3.67183L10.3913 2.61183C9.3596 1.58013 7.96032 1.00053 6.50129 1.00053C5.04226 1.00053 3.64298 1.58013 2.61129 2.61183C1.5796 3.64352 1 5.04279 1 6.50183C1 7.96086 1.5796 9.36013 2.61129 10.3918L3.67129 11.4518L11.4513 19.2318L19.2313 11.4518L20.2913 10.3918C20.8023 9.88107 21.2076 9.27464 21.4842 8.60718C21.7608 7.93972 21.9031 7.22431 21.9031 6.50183C21.9031 5.77934 21.7608 5.06393 21.4842 4.39647C21.2076 3.72901 20.8023 3.12258 20.2913 2.61183Z" fill="#E56363" stroke="#E66363" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>  `
                      document.getElementById('likeLength').innerHTML = data.length

                    } else {
                    document.getElementById('like').innerHTML = `<svg width="23" height="21" viewBox="0 0 23 21" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20.2913 2.61183C19.7805 2.10083 19.1741 1.69547 18.5066 1.41891C17.8392 1.14235 17.1238 1 16.4013 1C15.6788 1 14.9634 1.14235 14.2959 1.41891C13.6285 1.69547 13.022 2.10083 12.5113 2.61183L11.4513 3.67183L10.3913 2.61183C9.3596 1.58013 7.96032 1.00053 6.50129 1.00053C5.04226 1.00053 3.64298 1.58013 2.61129 2.61183C1.5796 3.64352 1 5.04279 1 6.50183C1 7.96086 1.5796 9.36013 2.61129 10.3918L3.67129 11.4518L11.4513 19.2318L19.2313 11.4518L20.2913 10.3918C20.8023 9.88107 21.2076 9.27464 21.4842 8.60718C21.7608 7.93972 21.9031 7.22431 21.9031 6.50183C21.9031 5.77934 21.7608 5.06393 21.4842 4.39647C21.2076 3.72901 20.8023 3.12258 20.2913 2.61183V2.61183Z" stroke="#AFAFAF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>   `
                    document.getElementById('likeLength').innerHTML = data.length
                }
            })
    }
</script>

</html>